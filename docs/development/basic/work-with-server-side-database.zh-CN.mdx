# 使用服务端数据库

LobeChat 提供了内置的客户端数据库体验。
但某些重要功能仅在服务端开发中可用。

为了使用服务端数据库功能，
需要参考 [部署服务端数据库](https://lobehub.com/docs/self-hosting/server-database) 的说明来配置所有前置条件。
本文档提供了一个更简化的配置方法，能够在本地开发时快速启动简化的服务端环境。

## 快速设置

### 环境配置

项目已经包含了一个 `.env.development` 文件，其中包含服务端数据库模式所需的所有环境变量。此文件配置了：

- **服务模式**: `NEXT_PUBLIC_SERVICE_MODE=server`
- **数据库**: 带连接字符串的 PostgreSQL
- **身份验证**: 带 Casdoor SSO 的 NextAuth
- **存储**: MinIO S3 兼容存储
- **搜索**: SearXNG 搜索引擎

### 启动 Docker 服务

使用 Docker Compose 启动所有必需的服务：

```bash
docker-compose -f docker-compose.development.yml up -d
```

这将启动以下服务：

- PostgreSQL 数据库（端口 5432）
- MinIO 存储（端口 9000）
- Casdoor 身份验证（端口 8000）
- SearXNG 搜索（端口 8080）

### 运行数据库迁移

执行数据库迁移脚本以创建所有必要的表：

```bash
pnpm db:migrate
```

预期输出：`✅ database migration pass.`

### 启动开发服务器

启动 LobeChat 开发服务器：

```bash
pnpm dev
```

服务器将在 `http://localhost:3010` 上启动

可以通过运行以下命令检查所有 Docker 服务运行状态：

```bash
docker-compose -f docker-compose.development.yml ps
```

### 重置服务

如遇到问题，可以重置整个服务堆栈：

```bash
# 停止并删除所有容器
docker-compose -f docker-compose.development.yml down

# 删除卷（这将删除所有数据）
docker-compose -f docker-compose.development.yml down -v

# 重新启动
docker-compose -f docker-compose.development.yml up -d
pnpm db:migrate
```
